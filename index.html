<!DOCTYPE html>
<html lang="id">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AnonChat - Chat Anonim</title>

    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>

    <!-- SweetAlert -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <!-- LordIcon -->
    <script src="https://cdn.lordicon.com/lordicon.js"></script>

    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            height: 100vh;
            overflow: hidden;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .chat-container {
            width: 100%;
            max-width: 400px;
            height: 90vh;
            background: #000;
            border-radius: 40px;
            overflow: hidden;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            display: flex;
            flex-direction: column;
            position: relative;
        }

        .chat-header {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(20px);
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .header-info {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }

        .user-info h3 {
            color: white;
            font-size: 16px;
            font-weight: 600;
        }

        .user-info p {
            color: rgba(255, 255, 255, 0.6);
            font-size: 12px;
        }

        .header-actions {
            display: flex;
            gap: 15px;
        }

        .header-actions button {
            background: none;
            border: none;
            color: white;
            font-size: 20px;
            cursor: pointer;
            transition: transform 0.2s;
        }

        .header-actions button:hover {
            transform: scale(1.1);
        }

        .chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
            background: #000;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .chat-messages::-webkit-scrollbar {
            width: 4px;
        }

        .chat-messages::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.1);
        }

        .chat-messages::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.3);
            border-radius: 2px;
        }

        .message {
            display: flex;
            align-items: flex-end;
            gap: 8px;
            animation: slideIn 0.3s ease-out;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .message.sent {
            flex-direction: row-reverse;
        }

        .message-avatar {
            width: 30px;
            height: 30px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 12px;
            font-weight: bold;
            flex-shrink: 0;
        }

        .message-content {
            max-width: 70%;
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .message-bubble {
            padding: 12px 16px;
            border-radius: 20px;
            word-wrap: break-word;
            position: relative;
        }

        .message.received .message-bubble {
            background: rgba(255, 255, 255, 0.1);
            color: white;
            border-bottom-left-radius: 4px;
        }

        .message.sent .message-bubble {
            background: #007AFF;
            color: white;
            border-bottom-right-radius: 4px;
        }

        .message-time {
            font-size: 11px;
            color: rgba(255, 255, 255, 0.4);
            padding: 0 16px;
        }

        .message.sent .message-time {
            text-align: right;
        }

        .typing-indicator {
            display: none;
            align-items: center;
            gap: 8px;
            padding: 10px 20px;
            color: rgba(255, 255, 255, 0.6);
            font-size: 14px;
        }

        .typing-dots {
            display: flex;
            gap: 4px;
        }

        .typing-dot {
            width: 8px;
            height: 8px;
            background: rgba(255, 255, 255, 0.6);
            border-radius: 50%;
            animation: typing 1.4s infinite;
        }

        .typing-dot:nth-child(2) {
            animation-delay: 0.2s;
        }

        .typing-dot:nth-child(3) {
            animation-delay: 0.4s;
        }

        @keyframes typing {

            0%,
            60%,
            100% {
                transform: translateY(0);
            }

            30% {
                transform: translateY(-10px);
            }
        }

        .chat-input {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(20px);
            padding: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        .input-wrapper {
            flex: 1;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 25px;
            padding: 10px 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .chat-input input {
            flex: 1;
            background: none;
            border: none;
            color: white;
            font-size: 16px;
            outline: none;
        }

        .chat-input input::placeholder {
            color: rgba(255, 255, 255, 0.5);
        }

        .input-actions {
            display: flex;
            gap: 10px;
        }

        .input-actions button {
            background: none;
            border: none;
            color: white;
            font-size: 20px;
            cursor: pointer;
            transition: transform 0.2s;
        }

        .input-actions button:hover {
            transform: scale(1.1);
        }

        .send-button {
            width: 40px;
            height: 40px;
            background: #007AFF;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s;
        }

        .send-button:hover {
            background: #0051D5;
            transform: scale(1.05);
        }

        .send-button:active {
            transform: scale(0.95);
        }

        .online-users {
            position: absolute;
            top: 80px;
            right: 20px;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
            padding: 10px 15px;
            border-radius: 20px;
            color: white;
            font-size: 12px;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .online-dot {
            width: 8px;
            height: 8px;
            background: #34C759;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% {
                box-shadow: 0 0 0 0 rgba(52, 199, 89, 0.7);
            }

            70% {
                box-shadow: 0 0 0 10px rgba(52, 199, 89, 0);
            }

            100% {
                box-shadow: 0 0 0 0 rgba(52, 199, 89, 0);
            }
        }

        .welcome-screen {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.95);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            backdrop-filter: blur(10px);
        }

        .welcome-content {
            text-align: center;
            color: white;
            padding: 40px;
        }

        .welcome-content h1 {
            font-size: 36px;
            margin-bottom: 10px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .welcome-content p {
            color: rgba(255, 255, 255, 0.7);
            margin-bottom: 30px;
        }

        .start-button {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 15px 40px;
            border-radius: 30px;
            font-size: 18px;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .start-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.4);
        }

        .waiting-screen {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.95);
            display: none;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            backdrop-filter: blur(10px);
        }

        .waiting-content {
            text-align: center;
            color: white;
            padding: 40px;
        }

        .waiting-content h2 {
            font-size: 28px;
            margin-bottom: 20px;
            color: white;
        }

        .waiting-content p {
            color: rgba(255, 255, 255, 0.7);
            margin-bottom: 30px;
        }

        .cancel-button {
            background: rgba(255, 255, 255, 0.1);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.3);
            padding: 12px 30px;
            border-radius: 30px;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .cancel-button:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .partner-info {
            display: flex;
            align-items: center;
            gap: 8px;
            color: rgba(255, 255, 255, 0.7);
            font-size: 12px;
        }

        @media (max-width: 480px) {
            .chat-container {
                height: 100vh;
                max-width: 100%;
                border-radius: 0;
            }
        }
    </style>
</head>

<body>
    <div class="chat-container">
        <div class="welcome-screen" id="welcomeScreen">
            <div class="welcome-content">
                <lord-icon src="https://cdn.lordicon.com/dycatgju.json" trigger="loop"
                    colors="primary:#667eea,secondary:#764ba2" style="width:100px;height:100px">
                </lord-icon>
                <h1>AnonChat</h1>
                <p>Chat anonim dengan 100% chat terenkripsi.<br>Pesan akan terhapus otomatis setelah 30 menit</p>
                <button class="start-button" onclick="startChat()" style="margin: 0 auto;">
                    <i class="fas fa-comments"></i>
                    Mulai Chat
                </button>
            </div>
        </div>

        <div class="waiting-screen" id="waitingScreen">
            <div class="waiting-content">
                <lord-icon src="https://cdn.lordicon.com/tdtlrbly.json" trigger="loop"
                    colors="primary:#667eea,secondary:#764ba2" style="width:100px;height:100px">
                </lord-icon>
                <h2>Mencari Partner...</h2>
                <p>Sedang mencari partner chat untuk Anda<br>Harap tunggu sebentar</p>
                <button class="cancel-button" onclick="cancelWaiting()">
                    <i class="fas fa-times"></i> Batal
                </button>
            </div>
        </div>

        <div class="chat-header">
            <div class="header-info">
                <div class="user-avatar" id="userAvatar">A</div>
                <div class="user-info">
                    <h3 id="username">Anonim</h3>
                    <div class="partner-info" id="partnerInfo" style="display: none;">
                        <i class="fas fa-user-circle"></i>
                        <span id="partnerName">-</span>
                    </div>
                    <p id="userStatus">Online</p>
                </div>
            </div>
            <div class="header-actions">
                <button onclick="showInfo()">
                    <i class="fas fa-info-circle"></i>
                </button>
                <button onclick="leaveChat()">
                    <i class="fas fa-sign-out-alt"></i>
                </button>
            </div>
        </div>

        <div class="online-users">
            <div class="online-dot"></div>
            <span id="onlineCount">1 online</span>
        </div>

        <div class="chat-messages" id="chatMessages">
            <div class="typing-indicator" id="typingIndicator">
                <span>Sedang mengetik</span>
                <div class="typing-dots">
                    <div class="typing-dot"></div>
                    <div class="typing-dot"></div>
                    <div class="typing-dot"></div>
                </div>
            </div>
        </div>

        <div class="chat-input">
            <div class="input-wrapper">
                <input type="text" id="messageInput" placeholder="Ketik pesan..." onkeypress="handleKeyPress(event)">
                <button onclick="attachFile()">
                    <i class="fas fa-paperclip"></i>
                </button>
            </div>
            <div class="input-actions">
                <button onclick="sendMessage()" class="send-button">
                    <i class="fas fa-paper-plane"></i>
                </button>
            </div>
        </div>
    </div>

    <script>
        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyAKF1eXOowCS35ylhonxvdy9QBiLYLmvzY",
            authDomain: "crht-proj.firebaseapp.com",
            databaseURL: "https://crht-proj-default-rtdb.firebaseio.com",
            projectId: "crht-proj",
            storageBucket: "crht-proj.firebasestorage.app",
            messagingSenderId: "957104910274",
            appId: "1:957104910274:web:5a7463a011d5f68583305b",
            measurementId: "G-4BTK874XF4"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();

        // Global Variables
        let currentUser = null;
        let currentRoomId = null;
        let partnerUser = null;
        let messagesRef = null;
        let usersRef = null;
        let waitingRef = null;
        let roomsRef = null;
        let typingRef = null;
        let waitingTimer = null;

        // Generate Random Username
        function generateUsername() {
            const adjectives = ['Bahagia', 'Ceria', 'Tenang', 'Semangat', 'Bijak', 'Ramah', 'Pintar', 'Keren'];
            const nouns = ['Kucing', 'Anjing', 'Burung', 'Ikan', 'Bunga', 'Matahari', 'Bulan', 'Bintang'];
            const randomAdjective = adjectives[Math.floor(Math.random() * adjectives.length)];
            const randomNoun = nouns[Math.floor(Math.random() * nouns.length)];
            const randomNumber = Math.floor(Math.random() * 1000);
            return `${randomAdjective}${randomNoun}${randomNumber}`;
        }

        // Generate Random IP-like identifier
        function generateRandomIP() {
            return `${Math.floor(Math.random() * 255)}.${Math.floor(Math.random() * 255)}.${Math.floor(Math.random() * 255)}.${Math.floor(Math.random() * 255)}`;
        }

        // Start Chat
        function startChat() {
            currentUser = {
                id: Date.now(),
                username: generateUsername(),
                avatar: generateUsername().charAt(0),
                ip: generateRandomIP(),
                timestamp: firebase.database.ServerValue.TIMESTAMP
            };

            document.getElementById('username').textContent = currentUser.username;
            document.getElementById('userAvatar').textContent = currentUser.avatar;
            document.getElementById('welcomeScreen').style.display = 'none';
            document.getElementById('waitingScreen').style.display = 'flex';

            // Initialize Firebase references
            waitingRef = database.ref('waiting');
            roomsRef = database.ref('rooms');

            // Add user to waiting list
            waitingRef.child(currentUser.id).set(currentUser);

            // Listen for room creation
            roomsRef.on('child_added', function (snapshot) {
                const room = snapshot.val();

                // Check if current user is in this room
                if (room.user1.id === currentUser.id || room.user2.id === currentUser.id) {
                    currentRoomId = snapshot.key;

                    // Set partner user
                    if (room.user1.id === currentUser.id) {
                        partnerUser = room.user2;
                    } else {
                        partnerUser = room.user1;
                    }

                    // Update UI
                    document.getElementById('waitingScreen').style.display = 'none';
                    document.getElementById('partnerInfo').style.display = 'flex';
                    document.getElementById('partnerName').textContent = partnerUser.username;
                    document.getElementById('userStatus').textContent = 'Terhubung dengan partner';

                    // Initialize room references
                    messagesRef = database.ref(`rooms/${currentRoomId}/messages`);
                    usersRef = database.ref(`rooms/${currentRoomId}/users`);
                    typingRef = database.ref(`rooms/${currentRoomId}/typing`);

                    // Add user to room
                    usersRef.child(currentUser.id).set({
                        username: currentUser.username,
                        lastSeen: firebase.database.ServerValue.TIMESTAMP
                    });

                    // Listen for messages
                    messagesRef.on('child_added', function (msgSnapshot) {
                        const message = msgSnapshot.val();
                        displayMessage(message);

                        // Auto-delete message after 30 minutes
                        setTimeout(() => {
                            msgSnapshot.ref.remove();
                        }, 30 * 60 * 1000);
                    });

                    // Listen for message removal
                    messagesRef.on('child_removed', function (msgSnapshot) {
                        const messageId = msgSnapshot.key;
                        const messageElement = document.querySelector(`[data-message-id="${messageId}"]`);
                        if (messageElement) {
                            messageElement.style.animation = 'slideOut 0.3s ease-out';
                            setTimeout(() => {
                                messageElement.remove();
                            }, 300);
                        }
                    });

                    // Update online users
                    usersRef.on('value', function (usersSnapshot) {
                        const users = usersSnapshot.val();
                        const onlineCount = users ? Object.keys(users).length : 0;
                        document.getElementById('onlineCount').textContent = `${onlineCount} online`;

                        // Check if partner is still online
                        if (onlineCount === 1 && users && users[currentUser.id]) {
                            // Partner left
                            Swal.fire({
                                title: 'Partner telah keluar',
                                text: 'Partner Anda telah meninggalkan chat',
                                icon: 'info',
                                confirmButtonText: 'OK',
                                confirmButtonColor: '#667eea'
                            }).then(() => {
                                leaveChat();
                            });
                        }
                    });

                    // Handle typing indicators
                    let typingTimer;
                    document.getElementById('messageInput').addEventListener('input', function () {
                        typingRef.child(currentUser.id).set(true);

                        clearTimeout(typingTimer);
                        typingTimer = setTimeout(() => {
                            typingRef.child(currentUser.id).remove();
                        }, 1000);
                    });

                    typingRef.on('value', function (typingSnapshot) {
                        const typingUsers = typingSnapshot.val();
                        const otherUserTyping = typingUsers && Object.keys(typingUsers).some(id => id != currentUser.id);

                        document.getElementById('typingIndicator').style.display = otherUserTyping ? 'flex' : 'none';
                    });

                    // Show connected notification
                    Swal.fire({
                        icon: 'success',
                        title: 'Terhubung!',
                        text: `Anda terhubung dengan ${partnerUser.username}`,
                        timer: 2000,
                        showConfirmButton: false
                    });
                }
            });

            // Set timeout for waiting
            waitingTimer = setTimeout(() => {
                if (document.getElementById('waitingScreen').style.display === 'flex') {
                    Swal.fire({
                        title: 'Tidak ada partner',
                        text: 'Tidak ada partner yang tersedia saat ini. Silakan coba lagi nanti.',
                        icon: 'info',
                        confirmButtonText: 'OK',
                        confirmButtonColor: '#667eea'
                    }).then(() => {
                        cancelWaiting();
                    });
                }
            }, 30000); // 30 seconds timeout
        }

        // Cancel Waiting
        function cancelWaiting() {
            if (waitingRef && currentUser) {
                waitingRef.child(currentUser.id).remove();
            }
            if (waitingTimer) {
                clearTimeout(waitingTimer);
            }
            document.getElementById('waitingScreen').style.display = 'none';
            document.getElementById('welcomeScreen').style.display = 'flex';
        }

        // Send Message
        function sendMessage() {
            const input = document.getElementById('messageInput');
            const messageText = input.value.trim();

            if (messageText === '' || !currentRoomId) {
                return;
            }

            const message = {
                id: Date.now(),
                text: messageText,
                senderId: currentUser.id,
                senderName: currentUser.username,
                senderAvatar: currentUser.avatar,
                timestamp: firebase.database.ServerValue.TIMESTAMP,
                type: 'text'
            };

            messagesRef.push(message);
            input.value = '';

            // Remove typing indicator
            if (typingRef) {
                typingRef.child(currentUser.id).remove();
            }
        }

        // Display Message
        function displayMessage(message) {
            const messagesContainer = document.getElementById('chatMessages');
            const messageElement = document.createElement('div');
            messageElement.className = `message ${message.senderId === currentUser.id ? 'sent' : 'received'}`;
            messageElement.setAttribute('data-message-id', message.id);

            const time = new Date(message.timestamp).toLocaleTimeString('id-ID', {
                hour: '2-digit',
                minute: '2-digit'
            });

            messageElement.innerHTML = `
                <div class="message-avatar">${message.senderAvatar}</div>
                <div class="message-content">
                    <div class="message-bubble">${message.text}</div>
                    <div class="message-time">${time}</div>
                </div>
            `;

            messagesContainer.insertBefore(messageElement, document.getElementById('typingIndicator'));
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }

        // Handle Enter Key
        function handleKeyPress(event) {
            if (event.key === 'Enter') {
                sendMessage();
            }
        }

        // Show Info
        function showInfo() {
            Swal.fire({
                title: 'Tentang AnonChat',
                html: `
                    <p style="text-align: left; margin: 20px 0;">
                        <strong>Fitur:</strong><br>
                        • Chat anonim 100%<br>
                        • Hanya untuk 2 orang per sesi<br>
                        • Pesan terhapus otomatis setelah 30 menit<br>
                        • Real-time messaging<br>
                        • Indikator sedang mengetik<br>
                        • Style iMessage iPhone<br>
                        • Responsive design
                    </p>
                `,
                icon: 'info',
                confirmButtonText: 'Mengerti',
                confirmButtonColor: '#667eea'
            });
        }

        // Leave Chat
        function leaveChat() {
            Swal.fire({
                title: 'Keluar dari chat?',
                text: 'Anda yakin ingin keluar dari sesi chat ini?',
                icon: 'warning',
                showCancelButton: true,
                confirmButtonText: 'Ya, Keluar',
                cancelButtonText: 'Batal',
                confirmButtonColor: '#dc3545'
            }).then((result) => {
                if (result.isConfirmed) {
                    // Remove from waiting list if still waiting
                    if (waitingRef && currentUser) {
                        waitingRef.child(currentUser.id).remove();
                    }

                    // Remove from room if in a room
                    if (usersRef && currentUser) {
                        usersRef.child(currentUser.id).remove();
                    }

                    // Remove typing indicator
                    if (typingRef && currentUser) {
                        typingRef.child(currentUser.id).remove();
                    }

                    // Check if room should be deleted
                    if (currentRoomId && usersRef) {
                        usersRef.once('value').then(snapshot => {
                            const users = snapshot.val();
                            if (!users || Object.keys(users).length <= 1) {
                                // Room is empty or only has current user, delete it
                                database.ref(`rooms/${currentRoomId}`).remove();
                            }
                        });
                    }

                    // Clear timeout if waiting
                    if (waitingTimer) {
                        clearTimeout(waitingTimer);
                    }

                    // Reset variables
                    currentUser = null;
                    currentRoomId = null;
                    partnerUser = null;

                    // Reload page
                    location.reload();
                }
            });
        }

        // Attach File (Placeholder)
        function attachFile() {
            Swal.fire({
                title: 'Fitur Coming Soon',
                text: 'Fitur attachment file akan segera hadir!',
                icon: 'info',
                confirmButtonText: 'OK',
                confirmButtonColor: '#667eea'
            });
        }

        // Add slide out animation
        const style = document.createElement('style');
        style.textContent = `
            @keyframes slideOut {
                to {
                    opacity: 0;
                    transform: translateX(-100%);
                }
            }
        `;
        document.head.appendChild(style);

        // Room matching logic
        waitingRef = database.ref('waiting');
        roomsRef = database.ref('rooms');

        // Listen for users in waiting list
        waitingRef.on('child_added', function (snapshot) {
            const waitingUser = snapshot.val();

            // Skip if it's the current user
            if (currentUser && waitingUser.id === currentUser.id) {
                return;
            }

            // Get all waiting users
            waitingRef.once('value').then(waitingSnapshot => {
                const waitingUsers = waitingSnapshot.val();
                const waitingUserIds = Object.keys(waitingUsers || {});

                // If there are at least 2 users waiting, create a room
                if (waitingUserIds.length >= 2) {
                    // Get the first two users
                    const user1Id = waitingUserIds[0];
                    const user2Id = waitingUserIds[1];
                    const user1 = waitingUsers[user1Id];
                    const user2 = waitingUsers[user2Id];

                    // Create a new room
                    const newRoomRef = roomsRef.push();
                    const roomId = newRoomRef.key;

                    newRoomRef.set({
                        user1: user1,
                        user2: user2,
                        createdAt: firebase.database.ServerValue.TIMESTAMP
                    });

                    // Remove users from waiting list
                    waitingRef.child(user1Id).remove();
                    waitingRef.child(user2Id).remove();
                }
            });
        });
    </script>
</body>

</html>
